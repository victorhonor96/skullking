<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skull King Solver</title>
<style>
body{background:#0f172a;color:#e5e7eb;font-family:system-ui;margin:0;padding:16px;max-width:480px;margin:auto}
.section{background:#1e293b;padding:12px;border-radius:14px;margin-bottom:12px}
select,button{width:100%;padding:10px;border-radius:10px;border:none;margin-top:6px;background:#020617;color:#fff}
button{background:#22c55e;color:#022c22;font-weight:bold}
.chip{background:#020617;padding:6px 10px;border-radius:999px;margin:4px;display:inline-block;cursor:pointer}
.bet{font-size:2.8rem;text-align:center;font-weight:900;color:#22c55e}
.card{background:#020617;padding:8px;border-radius:10px;margin-top:4px}
.small{font-size:.8rem;color:#94a3b8}
</style>
</head>
<body>

<h2>üè¥‚Äç‚ò†Ô∏è Skull King Solver</h2>

<div class="section">
<label>Jogadores</label>
<select id="players">
<option>2</option><option>3</option><option>4</option>
<option selected>5</option><option>6</option><option>7</option><option>8</option>
</select>
</div>

<div class="section">
<label>Adicionar carta</label>
<select id="type">
<option value="number">Num√©rica</option>
<option value="pirate">Pirata</option>
<option value="mermaid">Sereia</option>
<option value="escape">Fuga</option>
<option value="skull">Skull King</option>
<option value="tigress">Tigresa</option>
<option value="kraken">Kraken</option>
<option value="whale">Baleia</option>
</select>
<select id="suit">
<option value="black">Preto</option>
<option value="red">Vermelho</option>
<option value="blue">Azul</option>
<option value="yellow">Amarelo</option>
</select>
<select id="value">
<script>
for(let i=1;i<=13;i++)document.write(`<option>${i}</option>`)
</script>
</select>
<button onclick="addCard()">Adicionar</button>
</div>

<div class="section">
<label>Sua m√£o (toque para remover)</label>
<div id="hand"></div>
<button onclick="solve()">Rodar Solver</button>
</div>

<div class="section" id="output"></div>

<script>

// ====== CONFIG ======
const SIMS = 4000;

// ====== BARALHO BASE ======
function baseDeck(){
  const d=[];
  ["black","red","blue","yellow"].forEach(s=>{
    for(let i=1;i<=13;i++)d.push({type:"number",suit:s,value:i});
  });
  ["pirate","pirate","pirate","pirate","pirate",
   "mermaid","mermaid",
   "escape","escape","escape","escape","escape",
   "skull","tigress","kraken","whale"].forEach(t=>d.push({type:t}));
  return d;
}

let hand=[];
const handDiv=document.getElementById("hand");

function addCard(){
  hand.push({
    type:type.value,
    suit:suit.value,
    value:+value.value
  });
  renderHand();
}

function renderHand(){
  handDiv.innerHTML="";
  hand.forEach((c,i)=>{
    const el=document.createElement("div");
    el.className="chip";
    el.innerText=desc(c);
    el.onclick=()=>{hand.splice(i,1);renderHand();}
    handDiv.appendChild(el);
  });
}

function desc(c){
  if(c.type==="number") return `${c.value} ${c.suit}`;
  return c.type;
}

// ====== HIERARQUIA ======
function rank(card){
  if(card.type==="kraken"||card.type==="whale") return -1;
  if(card.type==="escape") return 0;
  if(card.type==="number"){
    return (card.suit==="black"?200:100)+card.value;
  }
  if(card.type==="mermaid") return 300;
  if(card.type==="pirate") return 400;
  if(card.type==="tigress") return 400;
  if(card.type==="skull") return 500;
}

// ====== SIMULAR VAZA ======
function trick(cards){
  if(cards.some(c=>c.type==="kraken"||c.type==="whale")) return -1;
  let winner=0;
  let best=rank(cards[0]);
  for(let i=1;i<cards.length;i++){
    const r=rank(cards[i]);
    if(r>best){ best=r; winner=i;}
  }
  return winner;
}

// ====== SOLVER ======
function solve(){
  const playersCount=+players.value;
  const rounds=hand.length;
  const dist=Array(rounds+1).fill(0);

  for(let sim=0;sim<SIMS;sim++){
    let deck=baseDeck();

    // remover sua m√£o do baralho
    hand.forEach(h=>{
      const idx=deck.findIndex(d=>JSON.stringify(d)===JSON.stringify(h));
      if(idx>-1) deck.splice(idx,1);
    });

    // embaralhar
    deck.sort(()=>Math.random()-0.5);

    // distribuir
    const opponents=[];
    for(let p=0;p<playersCount-1;p++){
      opponents.push(deck.splice(0,rounds));
    }

    let myWins=0;

    for(let r=0;r<rounds;r++){
      const table=[hand[r]];
      opponents.forEach(o=>table.push(o[r]));
      const winner=trick(table);
      if(winner===0) myWins++;
    }

    dist[myWins]++;
  }

  // normalizar
  const probs=dist.map(d=>d/SIMS);

  // calcular EV por aposta
  const ev=[];
  for(let bet=0;bet<=rounds;bet++){
    let total=0;
    for(let w=0;w<=rounds;w++){
      const p=probs[w];
      let score=0;
      if(bet===0){
        score = (w===0)? rounds*10 : -rounds*10;
      }else{
        if(w===bet) score=bet*20;
        else score=-10*Math.abs(w-bet);
      }
      total+=p*score;
    }
    ev.push(total);
  }

  const bestBet=ev.indexOf(Math.max(...ev));

  output.innerHTML=`
    <div class="bet">${bestBet}</div>
    <div style="text-align:center">Aposta √≥tima (EV m√°ximo)</div>
    <hr>
    <div class="small">Distribui√ß√£o de vazas:</div>
    ${probs.map((p,i)=>`<div class="card">${i} vazas ‚Üí ${(p*100).toFixed(1)}%</div>`).join("")}
    <hr>
    <div class="small">EV por aposta:</div>
    ${ev.map((e,i)=>`<div class="card">Apostar ${i} ‚Üí ${e.toFixed(1)}</div>`).join("")}
  `;
}

</script>
</body>
</html>
